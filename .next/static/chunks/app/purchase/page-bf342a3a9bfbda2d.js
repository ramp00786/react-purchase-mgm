(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[24],{1884:(e,t,r)=>{Promise.resolve().then(r.bind(r,5479))},1043:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var s=r(5155);r(2115);var a=r(8173),l=r.n(a);function d(){return(0,s.jsxs)("div",{className:"d-flex gap-4 justify-content-end",children:[(0,s.jsx)(l(),{href:"/purchase",children:"Create New"}),(0,s.jsx)(l(),{href:"/",children:"All Orders"})]})}},5479:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(5155),a=r(2115);r(5685);var l=r(8008),d=r(6046),i=r(1043);function c(){let e=(0,d.useRouter)(),[t,r]=(0,a.useState)([]),[c,n]=(0,a.useState)([]),[o,p]=(0,a.useState)({supplier_id:"",products:[],total_price:0});(0,a.useEffect)(()=>{l.A.get("/products.php").then(e=>{r(e.data)}),l.A.get("/suppliers.php").then(e=>{n(e.data)})},[]);let u=e=>{let t=o.products.filter(t=>t.id!==e);p({...o,products:t,total_price:parseFloat(o.total_price)-parseFloat(o.products.find(t=>t.id===e).price)})},h=(e,t)=>{let r=o.products.map(r=>r.id===t?{...r,quantity:parseInt(e.target.value)}:r),s=r.reduce((e,t)=>e+parseFloat(t.price)*t.quantity,0);p({...o,products:r,total_price:s})},x=async()=>{if(!o.supplier_id){alert("Please select a supplier");return}if(0===o.products.length){alert("Please add products.");return}try{let t=await l.A.post("/submit_purchase.php",o);console.log("Purchase submitted successfully:",t.data),alert("Order submitted successfully!"),e.push("/invoice/".concat(t.data.data.id))}catch(e){console.error("Error submitting order:",e),alert("Failed to submit order. Please try again.")}};return(0,s.jsx)("div",{className:"container mt-4",children:(0,s.jsxs)("div",{className:"row",children:[(0,s.jsxs)("div",{className:"col-md-12 ",children:[(0,s.jsx)("h3",{children:"Create Order"}),(0,s.jsx)(i.A,{}),(0,s.jsx)("hr",{})]}),(0,s.jsx)("div",{className:"col-md-6 mb-4",children:(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Supplier"}),(0,s.jsxs)("select",{className:"form-control",onChange:e=>p({...o,supplier_id:e.target.value}),children:[(0,s.jsx)("option",{value:"",children:"Select Supplier"}),c.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}),(0,s.jsx)("div",{className:"col-md-6 mb-4",children:(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Products"}),(0,s.jsxs)("select",{className:"form-control",onChange:e=>{let r=t.find(t=>parseInt(t.id)===parseInt(e.target.value));p({...o,products:[...o.products,{...r,quantity:1}],total_price:parseFloat(o.total_price)+parseFloat(r.price)})},children:[(0,s.jsx)("option",{value:"",children:"Select Product"}),t.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}),(0,s.jsx)("hr",{}),(0,s.jsxs)("div",{className:"col-md-12 my-4",children:[(0,s.jsxs)("table",{className:"table table-bordered",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"thead",children:[(0,s.jsx)("th",{children:"Code"}),(0,s.jsx)("th",{children:"Product Name"}),(0,s.jsx)("th",{children:"Quantity"}),(0,s.jsx)("th",{children:"Cost Price"}),(0,s.jsx)("th",{children:"GST (18%)"}),(0,s.jsx)("th",{children:"Total"}),(0,s.jsx)("th",{children:"Action"})]})}),(0,s.jsx)("tbody",{children:o.products.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.id}),(0,s.jsx)("td",{children:e.name}),(0,s.jsx)("td",{children:(0,s.jsx)("input",{type:"number",className:"form-control",defaultValue:e.quantity,min:1,onChange:t=>h(t,e.id)})}),(0,s.jsx)("td",{children:e.price}),(0,s.jsx)("td",{children:parseFloat(18*parseFloat(e.price)/100*parseInt(e.quantity)).toFixed(2)}),(0,s.jsx)("td",{children:parseFloat(parseFloat(e.price)*parseInt(e.quantity)+18*parseFloat(e.price)/100*parseInt(e.quantity)).toFixed(2)}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{className:"btn btn-danger",onClick:()=>u(e.id),children:"Remove"})})]},e.id))})]}),(0,s.jsx)("div",{className:"row d-flex justify-content-end",children:(0,s.jsx)("div",{className:"col-md-4 ",children:(0,s.jsx)("table",{className:"table table-bordered",children:(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"Sub Total"}),(0,s.jsx)("td",{children:parseFloat(o.products.reduce(function(e,t){return e+parseFloat(t.price)*parseInt(t.quantity)},0)).toFixed(2)})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"GST (18%)"}),(0,s.jsx)("td",{children:o.products.reduce((e,t)=>e+18*parseFloat(t.price)/100*parseInt(t.quantity),0).toFixed(2)})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"Grand Total"}),(0,s.jsx)("td",{children:parseFloat(parseFloat(o.products.reduce(function(e,t){return e+parseFloat(t.price)*parseInt(t.quantity)},0))+o.products.reduce((e,t)=>e+18*parseFloat(t.price)/100*parseInt(t.quantity),0)).toFixed(2)})]})]})})})}),(0,s.jsx)("div",{className:"form-group d-flex justify-content-end",children:(0,s.jsx)("button",{className:"btn btn-primary",onClick:x,children:"Submit Order"})})]})]})})}},8008:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=r(2651).A.create({baseURL:"http://react-purchase-manager.infy.uk",headers:{Authorization:"cvfqxymXb7rZHOWXHhjsDXFI7vRUyfusKVqk9MmBpRqSxDRiL9JtYkgMmK1OLq9U","Content-Type":"application/json"}})}},e=>{var t=t=>e(e.s=t);e.O(0,[740,902,441,517,358],()=>t(1884)),_N_E=e.O()}]);